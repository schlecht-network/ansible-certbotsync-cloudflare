---
- name: "distributecerts"
  hosts: distributiongroup
  tasks:
{% if cert_copydest is defined %}
    - name: "copy cert.pem"
      become: true
      copy:
        src: /home/{{ local_ansible_user }}/cert.pem
        dest: {{ cert_copydest }}
        owner: {{ destination_owner }}
        group: {{ destination_group }}
        mode: {{ destination_mode }}
{% endif %}
{% if chain_copydest is defined %}
    - name: "copy chain.pem"
      become: true
      copy:
        src: /home/{{ local_ansible_user }}/chain.pem
        dest: {{ chain_copydest }}
        owner: {{ destination_owner }}
        group: {{ destination_group }}
        mode: {{ destination_mode }}
{% endif %}
{% if fullchain_copydest is defined %}
    - name: "copy fullchain.pem"
      become: true
      copy:
        src: /home/{{ local_ansible_user }}/fullchain.pem
        dest: {{ fullchain_copydest }}
        owner: {{ destination_owner }}
        group: {{ destination_group }}
        mode: {{ destination_mode }}
{% endif %}
{% if privkey_copydest is defined %}
    - name: "copy privkey.pem"
      become: true
      copy:
        src: /home/{{ local_ansible_user }}/privkey.pem
        dest: {{ privkey_copydest }}
        owner: {{ destination_owner }}
        group: {{ destination_group }}
        mode: {{ destination_mode }}
{% endif %}
{% if aftercopy_restart_services is defined %}
{% raw %}
    - name: "restart services"
      become: true
      systemd: 
        name: "{{ item }}"
        state: restarted
{% endraw %}
      with_items:
{% for service in aftercopy_restart_services %}
        - {{ service }}
{% endfor %}
{% endif %}
